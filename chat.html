<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Chat do Cliente</title>
    <style>
        #chat { height: 300px; overflow-y: scroll; border: 1px solid #ccc; padding: 10px; }
        #mensagem { width: 70%; padding: 5px; }
        button { padding: 5px 10px; }
        #status { font-weight: bold; color: green; }
    </style>
</head>
<body>
    <h2>Chat com Suporte</h2>
    <div id="chat"></div>
    <input type="text" id="mensagem" placeholder="Digite sua mensagem">
    <button onclick="enviarMensagem()">Enviar</button>
    <p>Status do Suporte: <span id="status">Offline</span></p>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>
    <script>
        // Configuração do Firebase (substitua pelo seu)
  const firebaseConfig = {
    apiKey: "AIzaSyA1C3iYQe22zhTP5HVj19atOZLROtba3rw",
    authDomain: "jogo-do-bicho-421ff.firebaseapp.com",
    databaseURL: "https://jogo-do-bicho-421ff-default-rtdb.firebaseio.com",
    projectId: "jogo-do-bicho-421ff",
    storageBucket: "jogo-do-bicho-421ff.firebasestorage.app",
    messagingSenderId: "1023919123583",
    appId: "1:1023919123583:web:b6c561fb121fe54f9e234a",
    measurementId: "G-BPH150V2SG"
  };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // Autenticação anônima
        firebase.auth().signInAnonymously().then((user) => {
            const clienteId = user.user.uid; // UID único do cliente
            const mensagensRef = db.ref('mensagens/' + clienteId);
            const statusRef = db.ref('status/' + clienteId);
            const adminStatusRef = db.ref('status/admin');

            // Enviar mensagem
            window.enviarMensagem = function() {
                const texto = document.getElementById('mensagem').value;
                if (texto) {
                    mensagensRef.push({
                        texto: texto,
                        de: 'cliente',
                        timestamp: Date.now()
                    });
                    document.getElementById('mensagem').value = '';
                }
            };

            // Exibir mensagens em tempo real
            mensagensRef.on('child_added', (snapshot) => {
                const msg = snapshot.val();
                const chat = document.getElementById('chat');
                chat.innerHTML += `<p><b>${msg.de === 'cliente' ? 'Você' : 'Suporte'}:</b> ${msg.texto}</p>`;
                chat.scrollTop = chat.scrollHeight;
            });

            // Detectar status do cliente
            statusRef.set({ online: true });
            window.onunload = () => statusRef.set({ online: false });

            // Mostrar status do admin
            adminStatusRef.on('value', (snapshot) => {
                const status = snapshot.val()?.online ? 'Online' : 'Offline';
                document.getElementById('status').textContent = status;
                document.getElementById('status').style.color = snapshot.val()?.online ? 'green' : 'red';
            });
        }).catch((error) => {
            console.error("Erro na autenticação:", error);
            alert("Erro ao conectar ao chat. Tente novamente.");
        });
    </script>
</body>
</html>
